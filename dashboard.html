<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Charhate Medical</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&
family=Noto+Sans+Devanagari:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<script>
// üîê BLOCK UNAUTHORIZED ACCESS
if (localStorage.getItem("admin-authenticated") !== "yes") {
    window.location.href = "admin-login.html";
}
</script>

<style>
.card {
  background:#0f1613;
  padding:20px;
  border-radius:12px;
  border:1px solid rgba(245,196,83,0.4);
  margin-bottom:25px;
}
input, select {
  width:100%;
  padding:10px;
  border-radius:8px;
  margin:5px 0 12px;
  border:1px solid rgba(245,196,83,0.4);
  background:#050909;
  color:white;
}
.success { color:#4caf50; margin-top:8px; }
.error { color:#ff6b6b; margin-top:8px; }
table { width:100%; margin-top:15px; border-collapse:collapse; }
th, td {
  padding:10px;
  border-bottom:1px solid rgba(245,196,83,0.2);
}
</style>

</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <div class="brand">
      <img src="images/logo.png" class="brand-logo">
      <div class="brand-text">
        <h1>Admin Dashboard</h1>
        <p>Manage Products</p>
      </div>
    </div>

    <button class="btn outline small" onclick="logoutAdmin()">Logout</button>
  </div>
</header>

<section class="section">

  <!-- ADD PRODUCT -->
  <div class="card">
    <h2 style="font-family:'Noto Sans Devanagari';">‡§®‡§µ‡•Ä‡§® ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ú‡•ã‡§°‡§æ</h2>
    <p>(Add New Product)</p>

    <select id="category">
      <option value="">Select Category</option>
      <option>Medicines</option>
      <option>Pet Food</option>
      <option>Grooming</option>
      <option>Accessories</option>
    </select>

    <input id="name" placeholder="Product Name">
    <input id="description" placeholder="Description">
    <input id="price" placeholder="Price" type="number">

    <button class="btn primary" onclick="addProduct()">‚ûï Add Product</button>
    <p id="addStatus"></p>
  </div>

  <!-- CURRENT PRODUCT LIST -->
  <div class="card">
    <h2 style="font-family:'Noto Sans Devanagari';">‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®‡•á</h2>
    <p>(Current Product List)</p>

    <table>
      <thead>
        <tr>
          <th>Category</th>
          <th>Name</th>
          <th>Description</th>
          <th>Price</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="productTable"></tbody>
    </table>

    <p style="color:#9ca3af;font-size:0.8rem;">
      * Data shown below comes directly from Google Sheet.
    </p>
  </div>

</section>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx1pLV1oIaB8TNNLHUzbhV3wtyB9HrHavfwlcBJJvmoHMEAdm71kx09BdeLaPy9fLhNjA/exec";
const SHEET_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR8PnK0BnjvcYRZCjYSftjYE5Qh2S7H3oqcxyAvNMUom9rGT_PQcibFgCyvR5S_DjhVUxdnfR7lvdkt/pub?gid=0&single=true&output=csv";

// ADD PRODUCT ‚Üí GOOGLE SHEET
async function addProduct() {
  const item = {
    action: "add",
    category: category.value,
    name: name.value.trim(),
    description: description.value.trim(),
    price: price.value.trim()
  };

  if (!item.category || !item.name || !item.price) {
    document.getElementById("addStatus").innerHTML = "<span class='error'>All fields required.</span>";
    return;
  }

  let res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(item)
  });

  let json = await res.json();

  if (json.success) {
    document.getElementById("addStatus").innerHTML = "<span class='success'>Product added!</span>";
    loadProducts();
  } else {
    document.getElementById("addStatus").innerHTML = "<span class='error'>Error adding product.</span>";
  }
}

// DELETE PRODUCT ‚Üí GOOGLE SHEET
async function deleteProduct(name) {
  let res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "delete", name })
  });

  loadProducts();
}

// LOAD PRODUCTS FROM GOOGLE SHEET CSV
async function loadProducts() {
  const res = await fetch(SHEET_CSV);
  const csv = await res.text();
  const rows = csv.trim().split("\n").slice(1);

  let table = "";

  rows.forEach(row => {
    let col = row.split(",");
    table += `
      <tr>
        <td>${col[0]}</td>
        <td>${col[1]}</td>
        <td>${col[2]}</td>
        <td>‚Çπ${col[3]}</td>
        <td><button class="btn outline small" onclick="deleteProduct('${col[1]}')">Delete</button></td>
      </tr>`;
  });

  document.getElementById("productTable").innerHTML = table;
}

function logoutAdmin() {
  localStorage.removeItem("admin-authenticated");
  window.location.href = "admin-login.html";
}

loadProducts();
</script>

</body>
</html>
